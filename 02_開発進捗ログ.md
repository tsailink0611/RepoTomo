# RepoTomo 開発進捗ログ

## 2025年1月 - プロジェクト再構築

### 2025/01/20
- 技術スタック変更: GAS → React + Supabase + Vercel
- 超低コスト構成への設計変更（月額0円〜数百円）
- 技術仕様書作成完了（データベース、API、セキュリティ、環境、デプロイ）

## 2025年7月 - 実装フェーズ開始

### 2025/07/23 - Phase 0: 準備フェーズ完了 ✅
**完了済み**
- ✅ アーキテクチャ設計完了（GAS→React+Supabase+Vercel移行方針）
- ✅ データベース設計完了（PostgreSQL schema + RLS policies）
- ✅ 技術仕様書作成完了（5つの詳細ドキュメント）
- ✅ AI_HANDOVER_PROMPT.md 作成（他AI向け詳細仕様）
- ✅ 型定義ファイル作成（`src/types/database.ts`）
- ✅ モックデータ準備（`src/mocks/mockData.ts`）
- ✅ 認証フック（モック版）実装（`src/hooks/useAuth.ts`）
- ✅ 環境変数管理設定（`.env.development`, `.env.production`）

**現在の状況**
- モックモードでの開発環境構築完了
- Supabaseプロジェクト作成待ち（ユーザー作業）

### 次のタスクリスト

#### ⏳ Phase 1: Supabase基盤（実装待機中）
**ユーザー作業**
- [ ] Supabaseプロジェクト作成
- [ ] 環境変数設定（.env作成）

**AI実装予定**
- [ ] Supabaseクライアント設定（`lib/supabase.ts`）
- [ ] useAuth.tsの本番版統合
- [ ] 既存Login.tsxのSupabase認証統合
- [ ] PostgreSQLマイグレーション実行

#### 📅 Phase 2: コア機能（予定）
- [ ] 報告書テンプレート表示機能
- [ ] 報告書提出機能（既存ReportForm.tsx活用）
- [ ] 完了画面（既存Complete.tsx活用）
- [ ] 管理者ダッシュボード基本機能

#### 📅 Phase 3: 高度機能（予定）
- [ ] リアルタイム通知システム（Supabase Realtime）
- [ ] 月額0円監視ダッシュボード
- [ ] アチーブメントシステム
- [ ] PWA機能（Service Worker）
- [ ] プッシュ通知機能

## 技術的な決定事項

### アーキテクチャ決定
- **フロントエンド**: React 18 + TypeScript + Vite + Tailwind CSS
- **バックエンド**: Supabase (PostgreSQL + Auth + Edge Functions)
- **ホスティング**: Vercel + Cloudflare
- **PWA**: Vite PWA Plugin
- **状態管理**: Zustand + React Query

### データベース設計（PostgreSQL）

**staffテーブル**
```sql
CREATE TABLE staff (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  staff_id TEXT UNIQUE NOT NULL,
  name TEXT NOT NULL,
  line_user_id TEXT UNIQUE,
  role TEXT DEFAULT 'STAFF',
  is_active BOOLEAN DEFAULT true,
  preferred_reminder_time TIME DEFAULT '18:00'
);
```

**submissionsテーブル**
```sql
CREATE TABLE submissions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  staff_id UUID REFERENCES staff(id),
  report_id UUID REFERENCES report_templates(id),
  answers JSONB,
  mood TEXT CHECK (mood IN ('happy', 'neutral', 'need_help')),
  has_question BOOLEAN DEFAULT false,
  question TEXT,
  submitted_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### Supabase API設計
**認証エンドポイント**
- Supabase Auth (LINE Login)
- Row Level Security (RLS)

**データアクセス**
- Supabase JavaScript Client
- 自動生成されるREST API
- リアルタイムSubscriptions

**Edge Functions**
- LINE Messaging API Webhook
- リマインダー送信処理

## コスト最適化戦略

### 無料枠内での運用
- **Supabase Free**: 500MB DB + 認証 + Edge Functions
- **Vercel Hobby**: 100GB帯域 + 6000分ビルド時間
- **Cloudflare Free**: CDN + DNS
- **LINE API**: 月1000通無料

### モニタリング項目
- データベースサイズ (500MB以内)
- 月間アクティブユーザー数 (50,000以内)
- Vercel帯域使用量 (100GB以内)
- LINEメッセージ送信数 (月1000通以内)

### 課題・検訍事項
- データベース容量管理（古いデータの自動削除）
- パフォーマンス最適化（キャッシュ活用）
- PWAオフライン機能の範囲
- セキュリティ・認証フローの詳細設計

## 参考資料
- [Supabase公式ドキュメント](https://supabase.com/docs)
- [Vercel公式ドキュメント](https://vercel.com/docs)
- [React 18公式ドキュメント](https://react.dev/)
- [Vite PWA Plugin](https://vite-pwa-org.netlify.app/)
- [LINE Messaging API](https://developers.line.biz/ja/docs/messaging-api/)
- [Tailwind CSS](https://tailwindcss.com/docs)